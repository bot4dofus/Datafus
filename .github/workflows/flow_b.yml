name: Flow B
 
on:
  workflow_dispatch:
  push:
    paths:
      - 'data/d2o/*'
    branches:
      - master

jobs:
  Flow_B:
  
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.8
          
      - name: B1 - Build .json
        run: |
            python src/B1.py ../data/d2o/ ../data/entities_json/
          
      - name: Get latest Dofus version
        run: |
          chmod +x devscript/latest-dofus-version.sh
          export DOFUS_VERSION=$(devscript/latest-dofus-version.sh)
          echo The current Dofus version is $DOFUS_VERSION
          echo "::set-env name=VERSION::$DOFUS_VERSION"
        env:
          ACTIONS_ALLOW_UNSECURE_COMMANDS: 'true'

      - name: Commit and push
        uses: EndBug/add-and-commit@v7
        with:
          add: '["data/entities_json/"]'
          message: 'Flow B - Update version ${{ env.VERSION }}'
          push: true
