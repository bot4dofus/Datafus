name: Workflow

on:
  workflow_dispatch:
  push:
    paths:
      - 'data/DofusInvoker.swf'
      - 'data/d2o/*'
      - 'data/d2i/*'
      - '.github/workflows/workflow.yml'
    branches:
      - master

jobs:

  Flow_Test1_:
    runs-on: ubuntu-latest

    steps:
      - name: Filter path 1
        uses: dorny/paths-filter@v2
        id: changes
        with:
          filters: |
            src:
              - '.github/workflows/workflow.yml'
    
      - name: Echo Test 1
        if: steps.changes.outputs.src == 'true'
        run: |
          echo "This is Flow Test 1"

  Flow_Test2_:
    runs-on: ubuntu-latest

    steps:
      - name: Filter path 2
        uses: dorny/paths-filter@v2
        id: changes
        with:
          filters: |
            src:
              - 'data/**'
    
      - name: Echo Test 2
        if: steps.changes.outputs.src == 'true'
        run: |
          echo "This is Flow Test 2"

  Flow_A_:
    runs-on: ubuntu-latest
    if: (github.event_name == 'workflow_dispatch') || contains(github.event.commits[*].modified[*], 'data/DofusInvoker.swf')

    steps:
      - name: Echo A
        run: |
          echo "This is Flow A"

  Flow_B_:
    runs-on: ubuntu-latest
    if: (github.event_name == 'workflow_dispatch') || contains(github.event.commits[*].modified[*], 'data/d2o')

    steps:
      - name: Echo B
        run: |
          echo "This is Flow B"

  Flow_C_:
    runs-on: ubuntu-latest
    if: (github.event_name == 'workflow_dispatch') || contains(github.event.commits[*].modified[*], 'data/d2i')

    steps:
      - name: Echo C
        run: |
          echo "This is Flow C"

  Publish_:
    runs-on: ubuntu-latest
    needs: [Flow_A_, Flow_B_, Flow_C_]

    steps:
      - name: Echo Publish
        run: |
          echo "This is Publish"
